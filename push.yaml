version: v2
description: Blocks-Robotiq2f85-CustomOmni-Push
budget: ai2/robots
tasks:
- name: eval
  replicas: 1
  image:
    beaker: jasonl/isaac-lab
  command: ['/bin/bash', '-c']
  arguments:
  - >-
    nvidia-smi && pwd && ls -la && 
    source env_isaaclab/bin/activate && 
    cd /weka/oe-training-default/jasonl/IsaacLab &&
    echo "Y" | ./isaaclab.sh --install &&
    echo "Y" | ./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/train.py \
      --task Blocks-Robotiq2f85-CustomOmni-Push \
      --headless \
      --logger wandb \
      --log_project_name Isaac-RL \
      --num_envs 2048 \
      --video --video_length 100 --video_interval 50000 \
      --run_name push-debug
      

  datasets:
  - mountPath: /weka/oe-training-default
    source:
      weka: oe-training-default
  result:
    path: /data/results
  envVars:
  - name: ALLENACT_DEBUG_VST_TIMEOUT
    value: 2000
  - name: ALLENACT_DEBUG
    value: true
  - name: NCCL_SOCKET_IFNAME
    value: ib
  - name: NCCL_TIMEOUT
    value: 36000000
  - name: WANDB_API_KEY
    secret: WANDB_API_KEY
  - name: WANDB_MODE
    value: "online"
  - name: WANDB_SILENT
    value: "true"          # optional, suppress CLI prompts
  - name: WANDB_CONSOLE
    value: "off"  
  - name: WANDB_USERNAME
    value: "ai2-robotics"
  - name: TERM
    value: "xterm"
  - name: ACCEPT_EULA
    value: "Y"

  resources:
    gpuCount: 1
    memory: 100GiB
  context:
    priority: urgent  
    preemptible: true
  constraints:
    cluster: [ ai2/ceres-cirrascale ]
  hostNetworking: true
  leaderSelection: true
